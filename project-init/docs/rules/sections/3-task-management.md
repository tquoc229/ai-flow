[← Back to Index](../project-policy-index.md) | [← Previous: Section 2](./2-pbi-management.md)

---

# Section 3: Task Management

**Contains:** Task Overview, Document Structure, Workflow States, State Transitions, Synchronization, History Logging, Validation Rules, Version Control

---

## 4. Task Management

### 4.1 Overview

**Purpose:** Defines how tasks are created, executed, and tracked as the smallest units of work within PBIs.

**Key Concepts:**
- Tasks are **atomic units of work** that implement specific parts of a PBI
- Each task follows a defined workflow with clear state transitions
- All task changes are synchronized between task file and index
- Only one task per PBI should be InProgress at any time

---

### 4.2 Task Document Structure

**Location:** `docs/delivery/<PBI-ID>/`

**File Naming Convention:**

| File Type | Pattern | Example |
|-----------|---------|---------|
| Task List | `tasks.md` | `docs/delivery/6/tasks.md` |
| Task Details | `<PBI-ID>-<TASK-ID>.md` | `docs/delivery/6/6-1.md` |

**Required Sections in Task Files:**

```markdown
---
type: task
priority: medium
created: YYYY-MM-DD
updated: YYYY-MM-DD
estimated_hours: X
---
# Task: [Task-ID] [Task-Name]
[Back to task list](tasks.md)

## Goal
[What this task achieves]

## Context
[Why we're doing this]

## Status History
| Timestamp | Action | From Status | To Status | Details | User |
|-----------|---------|---------|---------|---------|---------|
| ... | ... | ... | ... | ... | ... |

## Requirements
- [ ] Requirement 1
- [ ] Requirement 2

## Implementation Steps
1. Step 1: [Description]
 - ...
2. Step 2: [Description]
 - ...

## Files to Modify/Create
- [ ] path/to/file1.js - [What to do]
- [ ] path/to/new-file.ts - [Create new]

## Testing
**Test Cases**:
- [ ] Test case 1
- [ ] Test case 2

## Success Criteria
- [ ] Implementation complete
- [ ] Tests passing
- [ ] Code follows standards

## References
[Links to relevant docs]

```

**Core Principles:**

✅ Each task has its own dedicated markdown file
✅ Files created **IMMEDIATELY** when task added to index
✅ Naming convention strictly followed
✅ All required sections must be present and complete
✅ Links maintained bidirectionally (index ↔ task file)

**Linking Patterns:**

**From task index to task file:**
```markdown
| 6-1 | [Define Circuit Breaker](6-1.md) | Proposed | ... |
```

**From task file to task index:**
```markdown
[Back to task list](tasks.md)
```

---

### 4.3 Task Workflow States

#### State Definitions

| State | Description | What It Means |
|-------|-------------|---------------|
| `Proposed` | Initial state | Task defined but not yet approved by User |
| `Agreed` | Approved | User approved, analysis complete, ready for implementation |
| `InProgress` | Active work | AI_Agent actively implementing the task |
| `Review` | Awaiting validation | Implementation complete, pending User review |
| `Done` | Completed | User approved, changes merged, task closed |
| `Blocked` | Cannot proceed | External dependency or issue preventing progress |

---

### 4.4 Task State Transitions

**Workflow Diagram:**

```
    [Proposed]
        ↓
    [Agreed]
        ↓
    [InProgress] ←→ [Blocked]
        ↓
    [Review]
        ↓
    [Done]
```

---

#### Transition 1: Creating and Auto-Approving a Task

**When:** AI_Agent decomposes PBI plan into tasks (after User approves PBI plan)

**State Change:** (none) → `Proposed` → `Agreed` (automatic)

**Who Can Do This:** AI_Agent (automatic after PBI plan approval)

**Context:**
- This transition happens when PBI status moves to `ReadyForTasks` or `Agreed`
- AI_Agent creates all task files and **automatically sets them to `Agreed`** status
- This eliminates the need for User to approve each task individually
- User has already approved the overall plan at PBI level

**Before Creating Tasks:**
- ✅ PBI plan is approved (PBI status: `ReadyForTasks` or `Agreed`)
- ✅ Tasks decomposed from approved implementation plan
- ✅ Each task represents atomic, implementable unit of work

**AI_Agent MUST Do:**
1. ✅ Create task documentation file named: `<PBI-ID>-<TASK-ID>.md`
2. ✅ Add task entry to task index with link: `[description](<PBI-ID>-<TASK-ID>.md)`
3. ✅ Populate all required sections in task file:
   - Description (clear and specific)
   - Requirements (from PBI breakdown)
   - Implementation Steps (detailed, executable)
   - Test Cases (appropriate to complexity)
   - Files to Modify/Create
4. ✅ Set task status to `Agreed` in task file (index auto-generated by pre-commit hook)
5. ✅ Add entries to task history:
   - First entry - Event_Type: "Created", From: N/A, To: Proposed
   - Second entry - Event_Type: "Auto-Approved", From: Proposed, To: Agreed
   - User: ai-agent
   - Details: "Auto-approved as part of PBI plan approval"
6. ✅ Commit task file (pre-commit hook will regenerate index automatically)

**Rationale for Auto-Approval:**
- User approved the PBI plan which includes task breakdown
- Tasks are derived directly from approved plan
- Reduces overhead - User doesn't need to click "approve" for each task
- User can still modify/reject tasks before they start (Agreed → InProgress requires verification)

**User Can Still:**
- ✅ Review all created tasks
- ✅ Modify task details before work starts
- ✅ Reject specific tasks (mark as N/A or delete)
- ✅ Add new tasks to the list

**Next Step:** Tasks are ready to start - AI_Agent can begin Transition 2 (Starting Work)

---

#### Transition 2: Starting Work on Task

**When:** Ready to begin implementing the task

**State Change:** `Agreed` → `InProgress`

**Who Can Do This:** AI_Agent (after verification checks)

**Before Starting Work:**
- ✅ No other tasks have status `InProgress` for this same PBI
- ✅ Task status is `Agreed` in task file
- ✅ All dependencies are available
- ✅ Implementation Steps are clear

**AI_Agent MUST Do:**
1. ✅ Check that no other tasks for this PBI are `InProgress`
   - If another task is InProgress → STOP and report to User
2. ✅ Verify task status is `Agreed` in task file
3. ✅ Create feature branch if using version control (e.g., `feature/<task-id>-description`)
4. ✅ Update task status to `InProgress` in task file
5. ✅ Add entry to task history:
   - Event_Type: "Started Work"
   - From: Agreed, To: InProgress
   - Details: "Began implementation, created feature branch" (or similar)
   - User: ai-agent
6. ✅ Update task documentation with start time and assignee
7. ✅ Commit task file (pre-commit hook will regenerate index automatically)
8. ✅ Begin implementation following the Implementation Plan

**Next Step:** Implement the task according to plan

---

#### Transition 3: Submitting Task for Review

**When:** Implementation complete, ready for User to review

**State Change:** `InProgress` → `Review`

**Who Can Do This:** AI_Agent

**Before Submitting:**
- ✅ All requirements from Requirements section are implemented
- ✅ All Test Cases from Testing section are implemented and passing
- ✅ Code follows project standards and conventions
- ✅ All modified files are documented in "Files to Modify/Create" section

**AI_Agent MUST Do:**
1. ✅ Run all relevant tests and verify they pass
   - If tests fail → fix issues before submitting
2. ✅ Update task documentation:
   - Implementation Plan: mark completed steps
   - Files Modified: list all changed files
   - Add implementation notes if needed
3. ✅ Update task status to `Review` in task file
4. ✅ Add entry to task history:
   - Event_Type: "Submitted for Review"
   - From: InProgress, To: Review
   - Details: "Implementation complete, all tests passing" (or similar)
   - User: ai-agent
5. ✅ Commit task file (pre-commit hook will regenerate index automatically)
6. ✅ Create pull request if applicable with:
   - Title: `[<task-id>] <task-description>`
   - Link to task file in description
7. ✅ Notify User that task is ready for review

**Next Step:** Wait for User to review and approve or reject

---

#### Transition 4: Approving Completed Task

**When:** User reviews task and confirms it meets all requirements

**State Change:** `Review` → `Done`

**Who Can Do This:** User only

**Before Approving:**
- ✅ All acceptance criteria are met
- ✅ Tests are passing
- ✅ Code quality is acceptable
- ✅ Implementation matches requirements

**AI_Agent MUST Do:**
1. ✅ **Review Next Tasks for Relevance (using Obsolescence Criteria below):**
   - Evaluate each remaining task against 4 obsolescence criteria
   - Identify tasks that may be OBSOLETE
   - Document findings for User review
   - Ask User: "Tasks [IDs] appear obsolete because [reasons]. Confirm removal or modification?"
   - Document User's decision
2. ✅ If User approves any task modifications:
   - Update affected task files (mark OBSOLETE or modify)
   - Status sync handled automatically (single source of truth)
   - Document changes in history
3. ✅ Merge changes to main branch (if using version control and applicable)
4. ✅ Update task status to `Done` in task file
5. ✅ Add entry to task history: timestamp, "Status Change", Review → Done, User name
6. ✅ Commit task file (pre-commit hook will regenerate index automatically)
7. ✅ Execute version control workflow:
   ```bash
   git acp "<task-id> <task-description>"
   ```
8. ✅ Archive task documentation (if project archives completed tasks)
9. ✅ Notify stakeholders of task completion

**Next Step:** Task complete, ready to start next task in PBI

---

#### Transition 5: Rejecting Task (Needs Rework)

**When:** User reviews task and finds issues that need fixing

**State Change:** `Review` → `InProgress`

**Who Can Do This:** User only

**Before Rejecting:**
- User has identified specific issues or gaps

**AI_Agent MUST Do:**
1. ✅ Document specific rejection reasons (from User feedback)
2. ✅ Update task documentation with review feedback in Description or new "Review Feedback" section
3. ✅ Update task status to `InProgress` in task file
4. ✅ Add entry to task history: timestamp, "Status Change", Review → InProgress, User name, with rejection reasons
5. ✅ Commit task file (pre-commit hook will regenerate index automatically)
6. ✅ Identify specific changes needed to address feedback
7. ✅ Resume implementation work to fix identified issues

**Next Step:** Fix issues and resubmit for review

---

#### Transition 6: Updating Task Requirements (During Review)

**When:** During review, User identifies that requirements need significant changes

**State Change:** `Review` → `InProgress`

**Who Can Do This:** User only

**Before Making This Transition:**
- Requirements or implementation approach changed significantly

**AI_Agent MUST Do:**
1. ✅ Document the nature of significant changes to:
   - Requirements section (if requirements changed)
   - Implementation Steps (if approach changed)
   - Testing (if test cases changed)
2. ✅ Update task status to `InProgress` in task file
3. ✅ Add entry to task history: timestamp, "Significant Update", Review → InProgress, reason for update, User name
4. ✅ Commit task file (pre-commit hook will regenerate index automatically)
5. ✅ Notify stakeholders that additional implementation work is needed
6. ✅ Resume development work to address updated requirements

**Next Step:** Implement the updated requirements

---

#### Transition 7: Blocking a Task

**When:** Task cannot proceed due to external dependency or issue

**State Change:** `InProgress` → `Blocked`

**Who Can Do This:** AI_Agent or User

**Before Blocking:**
- Clear blocker has been identified that prevents progress

**AI_Agent MUST Do:**
1. ✅ Stop all work on this task immediately
2. ✅ Document specific blocking reason in task file:
   - What is blocking the task?
   - What dependency is missing?
   - What decision is needed?
   - What external issue exists?
3. ✅ Identify any dependencies or issues causing the block
4. ✅ Update task status to `Blocked` in task file
5. ✅ Add entry to task history: timestamp, "Status Change", InProgress → Blocked, blocking reason, who identified it
6. ✅ Commit task file (pre-commit hook will regenerate index automatically)
7. ✅ Notify User and relevant stakeholders immediately with:
   - What is blocked
   - Why it's blocked
   - What's needed to unblock
8. ✅ Consider creating new tasks to address blockers (if applicable)

**Next Step:** Wait for blocker to be resolved

---

#### Transition 8: Unblocking a Task

**When:** The blocking issue has been resolved

**State Change:** `Blocked` → `InProgress`

**Who Can Do This:** AI_Agent or User (whoever resolves the blocker)

**Before Unblocking:**
- ✅ Blocking issue has been fully resolved
- ✅ All dependencies are now available
- ✅ Any required decisions have been made

**AI_Agent MUST Do:**
1. ✅ Document how the blocking issue was resolved
2. ✅ Update task file with resolution details in Description or dedicated section
3. ✅ Update task status to `InProgress` in task file
4. ✅ Add entry to task history: timestamp, "Status Change", Blocked → InProgress, resolution details, who unblocked
5. ✅ Commit task file (pre-commit hook will regenerate index automatically)
6. ✅ Resume work on the task from where it was stopped
7. ✅ Notify User and stakeholders that work has resumed

**Next Step:** Continue implementing the task

---

### 4.5 Task Status Management (Single Source of Truth)

**✨ NEW APPROACH:** Task status is maintained in a **SINGLE authoritative location** to eliminate synchronization errors.

**Single Source of Truth:**
- Task detail file (`<PBI-ID>-<TASK-ID>.md`) is the **authoritative source**
- Task index file (`tasks.md`) is **auto-generated** from task files
- Status only needs to be updated in ONE place (task file)

**How It Works:**

1. **AI updates task file** with new status
2. **Pre-commit hook automatically regenerates** task index from all task files
3. **Both files committed together** automatically
4. **Impossible to have mismatch** - index is always derived from task files

**Benefits:**
- ✅ Zero synchronization errors
- ✅ Reduced AI cognitive load (update 1 place, not 2)
- ✅ Automatic consistency guarantee
- ✅ Still human-readable and git-trackable

**AI_Agent Process:**

✅ **When updating status:**
1. Update status in task file only
2. Update status history in task file
3. Stage and commit changes
4. Pre-commit hook auto-regenerates index
5. Index included in same commit automatically

✅ **Pre-Work Verification:**
- Not needed! Index is always consistent with task files
- AI can trust that status in index matches source

**Technical Implementation:**

```bash
# Pre-commit hook: .git/hooks/pre-commit
#!/bin/bash
# Auto-generate task index from task files
node scripts/generate-task-index.js

# Stage generated files
git add docs/delivery/*/tasks.md

exit 0
```

**Status History** (still maintained in task file):
- Always add entry to task history when status changes
- Include timestamp, event type, from/to status, details, user
- This remains the audit trail

**Example - Task File (`6-1.md`):**

```markdown
## Status History

| Timestamp | Action | From | To | Details | User |
|-----------|--------|------|-----|---------|------|
| 2025-10-19 15:02:00 | Created | N/A | Proposed | Task file created for Circuit Breaker | Julian |
| 2025-10-19 16:15:00 | Approved | Proposed | Agreed | User approved task and analysis | Julian |
| 2025-10-20 09:00:00 | Started Work | Agreed | InProgress | Began implementation | ai-agent |
| 2025-10-20 14:30:00 | Submitted for Review | InProgress | Review | Implementation complete | ai-agent |
| 2025-10-21 10:00:00 | Approved | Review | Done | Reviewed and approved | Julian |
```

**Example - Task Index (`tasks.md`):**

```markdown
| Task ID | Name | Status | Description |
| :------ | :--- | :----- | :---------- |
| 6-1 | [Define Circuit Breaker](6-1.md) | Done | Define core state machine |
```

---

### 4.6 Task Concurrency Limit

**⚠️ MANDATORY RULE:** Only **ONE** task per PBI may be `InProgress` at any given time.

**Rationale:**
- Maintains focus and clarity
- Prevents conflicting changes
- Simplifies status tracking
- Easier to manage and review

**Exception:**
- User may explicitly approve multiple concurrent tasks in special cases
- Must be documented in task history
- Approval required each time

**Enforcement:**

```
Before starting ANY task:
    ↓
Check: Are there other InProgress tasks for this PBI?
    ↓
Yes → STOP and report to User
    ↓
No → Proceed with start_work transition
```

---

### 4.7 Task History Logging

**Location:** Task markdown file under `## Status History` section

**Purpose:** Track all changes to tasks for complete audit trail

**Required Fields:**

| Field | Format | Description |
|-------|--------|-------------|
| **Timestamp** | `YYYY-MM-DD HH:MM:SS` | When the change occurred |
| **Action** | String | What happened (plain language) |
| **From_Status** | String | Previous status (use N/A for creation) |
| **To_Status** | String | New status after change |
| **Details** | String | Additional context about the change |
| **User** | String | Who made the change |

**How to Log Actions:**

Use **plain language** that describes what you did:

| When you... | Log this Action |
|-------------|-----------------|
| Create new task | "Created" |
| Approve task | "Approved" |
| Start working | "Started Work" |
| Submit for review | "Submitted for Review" |
| Approve completed task | "Approved" |
| Reject task | "Rejected" |
| Update requirements | "Requirements Updated" |
| Block task | "Blocked" |
| Unblock task | "Unblocked" |

**Example History:**

```markdown
## Status History

| Timestamp | Action | From Status | To Status | Details | User |
|-----------|--------|-------------|-----------|---------|------|
| 2025-10-19 15:30:00 | Created | N/A | Proposed | Initial task creation for adding logging | Julian |
| 2025-10-19 16:00:00 | Approved | Proposed | Agreed | Task approved by PO, analysis complete | Julian |
| 2025-10-20 09:15:00 | Started Work | Agreed | InProgress | Began implementation, created feature branch | ai-agent |
| 2025-10-20 14:45:00 | Submitted for Review | InProgress | Review | All requirements met, tests passing | ai-agent |
| 2025-10-21 10:30:00 | Approved | Review | Done | Code reviewed and merged to main | Julian |
```

**More Examples:**

**Example 1: Task with Rejection**

```markdown
## Status History

| Timestamp | Action | From Status | To Status | Details | User |
|-----------|--------|-------------|-----------|---------|------|
| 2025-10-19 14:00:00 | Created | N/A | Proposed | Task created for API endpoint | Julian |
| 2025-10-19 14:30:00 | Approved | Proposed | Agreed | Analysis approved, ready to implement | Julian |
| 2025-10-20 09:00:00 | Started Work | Agreed | InProgress | Started implementation | ai-agent |
| 2025-10-20 16:00:00 | Submitted for Review | InProgress | Review | Implementation complete | ai-agent |
| 2025-10-21 10:00:00 | Rejected | Review | InProgress | Missing error handling for edge case | Julian |
| 2025-10-21 14:00:00 | Submitted for Review | InProgress | Review | Added comprehensive error handling | ai-agent |
| 2025-10-22 09:00:00 | Approved | Review | Done | All issues resolved, approved | Julian |
```

**Example 2: Task with Blocking**

```markdown
## Status History

| Timestamp | Action | From Status | To Status | Details | User |
|-----------|--------|-------------|-----------|---------|------|
| 2025-10-19 10:00:00 | Created | N/A | Proposed | Task for third-party API integration | Julian |
| 2025-10-19 11:00:00 | Approved | Proposed | Agreed | Approved for implementation | Julian |
| 2025-10-20 09:00:00 | Started Work | Agreed | InProgress | Began API integration work | ai-agent |
| 2025-10-20 11:00:00 | Blocked | InProgress | Blocked | Waiting for API credentials from vendor | ai-agent |
| 2025-10-22 14:00:00 | Unblocked | Blocked | InProgress | Credentials received, resuming work | Julian |
| 2025-10-22 17:00:00 | Submitted for Review | InProgress | Review | Integration complete and tested | ai-agent |
| 2025-10-23 10:00:00 | Approved | Review | Done | Integration working correctly | Julian |
```

**Example 3: Task with Requirements Update**

```markdown
## Status History

| Timestamp | Action | From Status | To Status | Details | User |
|-----------|--------|-------------|-----------|---------|------|
| 2025-10-19 09:00:00 | Created | N/A | Proposed | Task for user dashboard | Julian |
| 2025-10-19 10:00:00 | Approved | Proposed | Agreed | Initial requirements approved | Julian |
| 2025-10-20 09:00:00 | Started Work | Agreed | InProgress | Started dashboard implementation | ai-agent |
| 2025-10-21 15:00:00 | Submitted for Review | InProgress | Review | Dashboard complete per requirements | ai-agent |
| 2025-10-22 10:00:00 | Requirements Updated | Review | InProgress | Need to add real-time updates feature | Julian |
| 2025-10-23 16:00:00 | Submitted for Review | InProgress | Review | Added real-time updates via WebSocket | ai-agent |
| 2025-10-24 09:00:00 | Approved | Review | Done | All requirements met including real-time | Julian |
```

---

### 4.8 Task Validation Rules

**Purpose:** Ensure all tasks adhere to required standards and workflows.

**Core Validation Rules:**

✅ **Task Association:**
- Every task MUST be associated with an existing PBI
- Task ID MUST be unique within parent PBI

✅ **Workflow Compliance:**
- Tasks MUST follow defined workflow states
- Status transitions MUST be valid per Section 4.4
- All pre-conditions MUST be met before transitions

✅ **Documentation Requirements:**
- All required sections MUST be complete before marking `Done`
- History MUST be maintained for all status changes
- Files modified MUST be documented

✅ **File Consistency:**
- Every task in index MUST have corresponding markdown file
- Task descriptions MUST be linked using correct pattern
- Bidirectional links MUST be maintained

**Pre-Implementation Validation:**

Before starting work on any task, AI_Agent MUST verify:

1. ✅ Task exists in task file and index (index auto-generated from task file)
2. ✅ Task status is correct in task file
3. ✅ No other tasks are InProgress for same PBI
4. ✅ All task files that will be modified are accessible
5. ✅ Task ID will be referenced in all commits

**Error Prevention Protocol:**

```
Error detected (file inaccessible, etc.)
    ↓
⛔ STOP all work immediately
    ↓
📢 Report to User with details:
   - What is the error?
   - Where is it located?
   - What is the recommended fix?
    ↓
⏸️ Wait for User guidance
    ↓
✅ Apply fix in task file
    ↓
✅ Commit (pre-commit hook regenerates index)
    ↓
✅ Verify resolution
    ↓
✅ Log correction in history
```

**Change Management Validation:**

✅ **Commit Requirements:**
- Reference task ID in ALL commit messages
- Format: `<task-id> <task-description>`

✅ **Scope Verification:**
- All changes MUST be within task scope
- Document any deviations in task history
- Scope creep MUST be identified and addressed

✅ **Status Tracking:**
- Update task status according to workflow
- Link all changes to task
- Maintain audit trail

---

### 4.9 Task Obsolescence Criteria

**✨ NEW:** Clear criteria for AI agents to identify when tasks become obsolete and should be removed or modified.

---

#### When to Evaluate Task Relevance

AI_Agent should evaluate task relevance:
1. **After completing any task** (before User approval)
2. **When PBI requirements change**
3. **When discovering existing functionality** during implementation
4. **When User requests review** of remaining tasks

---

#### The 4 Obsolescence Criteria

A task should be marked **OBSOLETE** and proposed for removal if it meets ANY of these criteria:

---

**Criterion 1: Already Satisfied by Previous Work**

**Definition:** The task's requirements have already been fully satisfied by a previous task or implementation.

**Examples:**
- Task 6-3: "Add logging to API endpoints"
  - BUT: Task 6-2 already added comprehensive logging framework covering all endpoints
  - **OBSOLETE:** Functionality already exists

- Task 5-4: "Create user validation function"
  - BUT: Task 5-2 already implemented full validation in user service
  - **OBSOLETE:** Duplicate functionality

**AI_Agent Check:**
```markdown
1. Read previous completed tasks
2. Check if their implementation includes this task's requirements
3. If overlap >= 80% → Flag as potentially OBSOLETE
4. Document what was already implemented and where
```

---

**Criterion 2: Superseded by Implementation Approach**

**Definition:** The actual implementation path diverged from original plan, making this task unnecessary.

**Examples:**
- Task 6-4: "Add Redis cache for session storage"
  - BUT: Task 6-2 implemented JWT stateless auth (no sessions to cache)
  - **OBSOLETE:** Approach changed, sessions not needed

- Task 3-5: "Create separate API for mobile clients"
  - BUT: Task 3-3 made main API responsive to all clients
  - **OBSOLETE:** Different solution achieved same goal

**AI_Agent Check:**
```markdown
1. Review PBI implementation plan
2. Compare with actual implementation in completed tasks
3. If task assumes approach X but we implemented approach Y → Flag as OBSOLETE
4. Document how new approach addresses the original need differently
```

---

**Criterion 3: External Dependency Now Provides Functionality**

**Definition:** A third-party library, service, or platform update now includes the functionality this task was meant to build.

**Examples:**
- Task 7-5: "Build rate limiting middleware"
  - BUT: Express-rate-limit package now used (added in Task 7-2)
  - **OBSOLETE:** External library handles this

- Task 4-3: "Implement image optimization"
  - BUT: Cloudinary service (integrated in Task 4-1) includes optimization
  - **OBSOLETE:** Third-party service provides feature

**AI_Agent Check:**
```markdown
1. Review packages added in previous tasks
2. Check package documentation for features
3. If package provides >= 80% of task requirements → Flag as OBSOLETE
4. Document which package provides the functionality
```

---

**Criterion 4: PBI Requirements Changed**

**Definition:** User explicitly changed PBI requirements, removing the need for this task.

**Examples:**
- Task 2-6: "Add admin dashboard"
  - BUT: User decided admin features out of scope for MVP
  - **OBSOLETE:** Requirement removed from PBI

- Task 8-4: "Integrate payment gateway X"
  - BUT: User switched to payment gateway Y (different implementation needed)
  - **OBSOLETE:** Requirement changed, task invalid

**AI_Agent Check:**
```markdown
1. Compare task requirements with current PBI Conditions of Satisfaction
2. If task requirement not in current CoS → Ask User if intentionally removed
3. If User confirms removal → Flag as OBSOLETE
4. Document when and why requirement changed
```

---

#### Evaluation Process for AI_Agent

**Step-by-Step:**

```markdown
1. **List Remaining Tasks**
   - Get all tasks with status: Proposed, Agreed, Blocked
   - Exclude: InProgress, Review, Done (these are active or complete)

2. **For Each Task, Check All 4 Criteria:**

   Criterion 1: Already satisfied?
   ├─ Read completed task files
   ├─ Check for overlapping functionality
   └─ Overlap >= 80%? → Flag

   Criterion 2: Superseded by approach?
   ├─ Review implementation vs plan
   ├─ Different approach taken?
   └─ Makes task unnecessary? → Flag

   Criterion 3: External dependency provides it?
   ├─ Check packages/services added
   ├─ Research their capabilities
   └─ Provides >= 80% of requirements? → Flag

   Criterion 4: Requirements changed?
   ├─ Compare task req vs current PBI CoS
   ├─ Task req missing from CoS?
   └─ Ask User if intentional → If yes, Flag

3. **Document Findings:**

   For each flagged task, create report:

   **Task:** 6-4 Add Redis cache for sessions
   **Flagged As:** OBSOLETE
   **Criterion:** #2 - Superseded by implementation approach
   **Reason:** Task 6-2 implemented JWT stateless auth. No sessions exist to cache.
   **Impact:** No functionality lost - authentication works without sessions.
   **Recommendation:** Remove task from backlog.

4. **Present to User:**

   "Task relevance review complete. Found 3 potentially obsolete tasks:

   - Task 6-4: Superseded by stateless auth approach
   - Task 6-5: Already satisfied by Task 6-3's logging
   - Task 6-6: Requirements changed per PBI update

   Detailed analysis: <link to document>

   Please confirm removal or advise modifications."

5. **Execute User Decision:**
   - Remove: Delete task file, regenerate index
   - Modify: Update task file with new requirements
   - Keep: Document why task still relevant
   - Log decision in task history
```

---

#### Example: Complete Evaluation

**Scenario:** Completed Task 6-2 (Implement JWT Auth). Now evaluating Task 6-3 through 6-6.

**Task 6-3: Add session cleanup job**
```
Criterion 1: Already satisfied? NO - no cleanup implemented yet
Criterion 2: Superseded? YES - JWT auth has no sessions to clean up
Criterion 3: External dependency? N/A
Criterion 4: Requirements changed? NO - still in CoS but approach different

RESULT: OBSOLETE (Criterion 2)
RECOMMENDATION: Remove task
```

**Task 6-4: Create login rate limiting**
```
Criterion 1: Already satisfied? NO - rate limiting not implemented
Criterion 2: Superseded? NO - still needed for JWT auth
Criterion 3: External dependency? YES - express-rate-limit added in Task 6-2
Criterion 4: Requirements changed? NO - still in CoS

RESULT: OBSOLETE (Criterion 3)
RECOMMENDATION: Remove task, document that express-rate-limit handles this
```

**Task 6-5: Add password reset flow**
```
Criterion 1: Already satisfied? NO - not implemented
Criterion 2: Superseded? NO - still part of auth system
Criterion 3: External dependency? NO - custom logic needed
Criterion 4: Requirements changed? NO - still in CoS

RESULT: RELEVANT
RECOMMENDATION: Keep task, proceed as planned
```

**Task 6-6: Implement OAuth login**
```
Criterion 1: Already satisfied? NO
Criterion 2: Superseded? NO
Criterion 3: External dependency? NO
Criterion 4: Requirements changed? YES - User removed OAuth from MVP scope

RESULT: OBSOLETE (Criterion 4)
RECOMMENDATION: Remove task or move to future backlog
```

**Summary for User:**
```
Obsolete tasks: 6-3, 6-4, 6-6
Keep tasks: 6-5
Recommend removing 3 obsolete tasks.
```

---

#### Task Obsolescence States

When task is identified as OBSOLETE:

```markdown
**Status:** OBSOLETE
**Obsolete Date:** 2025-10-20
**Obsolete Reason:** Criterion 2 - Superseded by JWT stateless auth
**Obsolete By:** ai-agent (after Task 6-2 completion)
**User Confirmed:** 2025-10-20 by Julian
**Action:** Task removed from backlog
```

**History Entry:**
```
| 2025-10-20 15:30:00 | Marked Obsolete | Agreed | OBSOLETE | Superseded by JWT approach | ai-agent |
| 2025-10-20 15:45:00 | Removal Confirmed | OBSOLETE | Removed | User approved removal | Julian |
```

---

#### Anti-Patterns (What NOT to Mark Obsolete)

**DON'T mark obsolete just because:**

❌ **Task is hard** - Difficulty is not obsolescence
❌ **Task will take time** - Duration is not obsolescence
❌ **Task can be done later** - Deferral is not obsolescence
❌ **You found a different way to do it** - Alternative approach ≠ obsolete (User must approve)
❌ **Partial overlap** - Must be >= 80% overlap to be obsolete
❌ **Uncertainty** - When unsure, ASK User, don't assume obsolete

**DO mark obsolete when:**

✅ Requirements are fully met by existing implementation
✅ Implementation approach makes task logically impossible/unnecessary
✅ External tool definitively provides the functionality
✅ User confirms requirement is no longer needed

---

### 4.10 Version Control for Task Completion

**Purpose:** Ensure consistent version control practices when completing tasks.

**Commit Message Format:**

```
<task-id> <task-description>
```

**Examples:**

```bash
1-7 Add pino logging to help debug database connection issues
2-3 Implement exponential backoff for API retries
6-1 Define and implement Circuit Breaker state machine
```

**Pull Request Format:**

**Title:**
```
[<task-id>] <task-description>
```

**Description Template:**
```markdown
## Task Reference
Link to task: [Task <task-id>](path/to/task/file.md)

## Changes Made
- Change 1
- Change 2

## Testing
- Test scenario 1: ✅ Pass
- Test scenario 2: ✅ Pass

## Verification
Steps to verify this implementation works correctly.
```

**Automation Workflow:**

When task is marked `Done`, execute:

```bash
git acp "<task-id> <task-description>"
```

**This command performs:**
1. Stages all changes (`git add .`)
2. Creates commit with specified message (`git commit -m "..."`)
3. Pushes to remote branch (`git push`)

**Post-Commit Verification:**

✅ Verify commit appears in task history
✅ Confirm task status updated to `Done` in task file (index auto-generated)
✅ Validate commit message follows format
✅ Check pull request is created (if applicable)

---

### 4.10 Task Index File Structure

**Location:** `docs/delivery/<PBI-ID>/tasks.md`

**Purpose:** Provide consolidated view of all tasks for a PBI

**Required Format:**

```markdown
# Tasks for PBI <PBI-ID>: <PBI Title>

This document lists all tasks associated with PBI <PBI-ID>.

**Parent PBI**: [PBI <PBI-ID>: <PBI Title>](prd.md)

## Task Summary

| Task ID | Name | Status | Description |
| :------ | :--- | :----- | :---------- |
| 6-1 | [Define Circuit Breaker state machine](6-1.md) | Proposed | Define core state machine logic |
| 6-2 | [Implement retry logic with backoff](6-2.md) | Agreed | Add exponential backoff retry mechanism |
| 6-3 | [Add monitoring and metrics](6-3.md) | Proposed | Implement health check and metrics |
```

**Column Definitions:**

| Column | Content | Format |
|--------|---------|--------|
| **Task ID** | Unique identifier | `<PBI-ID>-<TaskNum>` (e.g., `6-1`) |
| **Name** | Task name with link | `[Task Name](<PBI-ID>-<TaskNum>.md)` |
| **Status** | Current status | One of: `Proposed`, `Agreed`, `InProgress`, `Review`, `Done`, `Blocked` |
| **Description** | Brief summary | One-sentence description of task objective |

**⚠️ Content Restrictions:**

The Task Summary table **MUST** contain:
- ✅ Only the four columns specified above
- ✅ Only task information (no additional notes or sections mixed in)
- ✅ Proper markdown linking to task files

**PROHIBITED** unless User explicitly approves:
- ❌ Additional columns
- ❌ Mixed content (notes, comments within table)
- ❌ Unlinked task entries

**Maintenance:**

✅ Update immediately when task status changes
✅ Keep synchronized with individual task files
✅ Add new tasks at bottom of table (FIFO order)
✅ Never remove tasks (keep for historical record)

---

## Navigation

- [← Back to Index](../project-policy-index.md)
- [← Previous: Section 2 - PBI Management](./2-pbi-management.md)
- [Next: Section 4 - Testing Strategy →](./4-testing-strategy.md)

---

**End of Section 3**
